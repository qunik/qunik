<!-- ... –í–µ—Å—å –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ... -->

<script>
  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...

  // –†–∞–∑–º–µ—Ä—ã –º–æ–¥–µ–ª–µ–π (–∫–∞–∫—Ç—É—Å –º–µ–Ω—å—à–µ)
  const dinoWidth = 80;
  const dinoHeight = 80;
  const cactusWidth = 48;  // –±—ã–ª–æ 60, —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ –Ω–∞ 20%
  const cactusHeight = 64; // –±—ã–ª–æ 80, —Å—Ç–∞–ª–æ –º–µ–Ω—å—à–µ –Ω–∞ 20%

  // –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∫–∞–∫—Ç—É—Å–æ–º
  const firstCactusDelay = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞

  // –ö–Ω–æ–ø–∫–∞ "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"
  const playAgainBtn = document.createElement('button');
  playAgainBtn.textContent = 'üéÆ –ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞';
  playAgainBtn.style.position = 'absolute';
  playAgainBtn.style.top = '60%';
  playAgainBtn.style.left = '50%';
  playAgainBtn.style.transform = 'translate(-50%, -50%)';
  playAgainBtn.style.padding = '12px 24px';
  playAgainBtn.style.fontSize = '24px';
  playAgainBtn.style.borderRadius = '12px';
  playAgainBtn.style.border = 'none';
  playAgainBtn.style.background = '#4caf50';
  playAgainBtn.style.color = '#fff';
  playAgainBtn.style.cursor = 'pointer';
  playAgainBtn.style.display = 'none';
  playAgainBtn.style.zIndex = '10000';
  playAgainBtn.style.boxShadow = '0 0 15px #4caf50';

  gameContainer.appendChild(playAgainBtn);

  playAgainBtn.addEventListener('click', () => {
    playAgainBtn.style.display = 'none';
    resetGame();
    gameRunning = true;
    firstCactusTimeout = null;
    requestAnimationFrame(gameLoop);
  });

  function gameLoop(timestamp) {
    if (!lastTimestamp) lastTimestamp = timestamp;
    const deltaTime = timestamp - lastTimestamp;
    lastTimestamp = timestamp;

    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç
    score += deltaTime * 0.01;
    scoreDiv.textContent = Math.floor(score);

    // –ò–≥—Ä–æ–∫ –ø—Ä—ã–≥–∞–µ—Ç
    velocityY += gravity;
    dinoY += velocityY;
    if (dinoY > canvas.height - dinoHeight - 20) {
      dinoY = canvas.height - dinoHeight - 20;
      isJumping = false;
      velocityY = 0;
    }
    ctx.drawImage(dinoImg, dinoX, dinoY, dinoWidth, dinoHeight);

    // –¢–∞–π–º–µ—Ä –ø–æ—è–≤–ª–µ–Ω–∏—è –∫–∞–∫—Ç—É—Å–æ–≤
    cactusTimer += deltaTime;

    if (cactuses.length === 0 && !firstCactusTimeout) {
      firstCactusTimeout = setTimeout(() => {
        cactuses.push({ x: canvas.width, y: canvas.height - cactusHeight - 20, width: cactusWidth, height: cactusHeight });
        cactusTimer = 0;
      }, firstCactusDelay);
    }

    if (cactusTimer > 1500 && cactuses.length > 0) {
      cactuses.push({ x: canvas.width, y: canvas.height - cactusHeight - 20, width: cactusWidth, height: cactusHeight });
      cactusTimer = 0;
    }

    // –î–≤–∏–∂–µ–Ω–∏–µ –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π
    for (let i = 0; i < cactuses.length; i++) {
      let c = cactuses[i];
      c.x -= speed;
      ctx.drawImage(cactusImg, c.x, c.y, c.width, c.height);

      // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–µ
      if (
        dinoX < c.x + c.width &&
        dinoX + dinoWidth > c.x &&
        dinoY < c.y + c.height &&
        dinoY + dinoHeight > c.y
      ) {
        gameRunning = false;
        playAgainBtn.style.display = 'block';
        alert('–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á–µ—Ç: ' + Math.floor(score));
        // –ù–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∏–≥—Ä—É —Å—Ä–∞–∑—É, –∂–¥–µ–º –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞"
        return;
      }
    }

    cactuses = cactuses.filter(c => c.x + c.width > 0);

    speed += 0.0005;

    if (gameRunning) {
      requestAnimationFrame(gameLoop);
    }
  }

  // ... –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π ...
</script>
